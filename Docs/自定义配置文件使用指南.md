# PolySms è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

PolySms æä¾›äº†çµæ´»çš„è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ”¯æŒï¼Œè®©æ‚¨å¯ä»¥ç‹¬ç«‹ç®¡ç†çŸ­ä¿¡æœåŠ¡é…ç½®ã€‚è¿™ç§æ–¹å¼ç‰¹åˆ«é€‚åˆç”Ÿäº§ç¯å¢ƒå’Œä¼ä¸šåº”ç”¨ï¼Œæä¾›äº†æ›´å¥½çš„å®‰å…¨æ€§å’Œé…ç½®ç®¡ç†çµæ´»æ€§ã€‚ç›¸æ¯”ä¼ ç»ŸSDKæ–¹æ¡ˆï¼ŒPolySmsé‡‡ç”¨è½»é‡çº§HTTPç›´è¿æ¶æ„ï¼Œé…ç½®æ›´ç®€å•ï¼Œæ€§èƒ½æ›´ä¼˜ã€‚

## å¿«é€Ÿå¼€å§‹

### 1. åˆ›å»ºé…ç½®æ–‡ä»¶

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `config/sms.json` æ–‡ä»¶ï¼š

```json
{
  "Sms": {
    "DefaultProvider": "Aliyun",
    "EnableFailover": true,
    "ProviderPriority": ["Aliyun", "Tencent"],
    "RetryOptions": {
      "EnableRetry": true,
      "MaxRetryAttempts": 3,
      "RetryDelaySeconds": 5
    }
  },
  "AliyunSms": {
    "AccessKeyId": "your-aliyun-access-key-id",
    "AccessKeySecret": "your-aliyun-access-key-secret",
    "Endpoint": "dysmsapi.aliyuncs.com"
  },
  "TencentSms": {
    "SecretId": "your-tencent-secret-id",
    "SecretKey": "your-tencent-secret-key",
    "Region": "ap-beijing",
    "SmsSdkAppId": "your-sms-sdk-app-id"
  }
}
```

### 2. é…ç½®æœåŠ¡

åœ¨ `Program.cs` ä¸­ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ï¼š

```csharp
using PolySms.Extensions;

var builder = WebApplication.CreateBuilder(args);

// ä»è‡ªå®šä¹‰é…ç½®æ–‡ä»¶åŠ è½½PolySmsæœåŠ¡
builder.Services.AddPolySmsFromConfigFile("config/sms.json");

var app = builder.Build();
```

### 3. ä½¿ç”¨æœåŠ¡

```csharp
[ApiController]
[Route("api/[controller]")]
public class SmsController : ControllerBase
{
    private readonly ISmsService _smsService;
    private readonly ILogger<SmsController> _logger;

    public SmsController(ISmsService smsService, ILogger<SmsController> logger)
    {
        _smsService = smsService;
        _logger = logger;
    }

    [HttpPost("send")]
    public async Task<IActionResult> SendSms([FromBody] SendSmsRequest request)
    {
        var smsRequest = new SmsRequest
        {
            PhoneNumber = request.PhoneNumber,
            TemplateId = request.TemplateId,
            SignName = request.SignName,
            TemplateParams = request.TemplateParams
        };

        try
        {
            // ä½¿ç”¨é…ç½®æ–‡ä»¶ä¸­çš„é»˜è®¤æä¾›å•†
            var response = await _smsService.SendSmsAsync(smsRequest);

            if (response.IsSuccess)
            {
                return Ok(new
                {
                    success = true,
                    provider = response.Provider,
                    requestId = response.RequestId,
                    bizId = response.BizId
                });
            }
            else
            {
                // ä½¿ç”¨æ ‡å‡†åŒ–é”™è¯¯å¤„ç†
                _logger.LogWarning("çŸ­ä¿¡å‘é€å¤±è´¥: {ErrorCode} - {ErrorMessage}",
                    response.StandardErrorCode, response.FriendlyErrorMessage);

                var errorResponse = new
                {
                    success = false,
                    error = response.FriendlyErrorMessage,
                    errorCode = response.StandardErrorCode.ToString(),
                    isRetryable = response.IsRetryable,
                    provider = response.Provider
                };

                return response.StandardErrorCode switch
                {
                    StandardErrorCode.RateLimitExceeded => StatusCode(429, errorResponse),
                    StandardErrorCode.AuthenticationFailed => Unauthorized(errorResponse),
                    StandardErrorCode.InsufficientBalance => StatusCode(402, errorResponse),
                    StandardErrorCode.InvalidParameter => BadRequest(errorResponse),
                    _ => StatusCode(500, errorResponse)
                };
            }
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "çŸ­ä¿¡å‘é€å¼‚å¸¸");
            return StatusCode(500, new { success = false, error = "ç³»ç»Ÿå¼‚å¸¸ï¼Œè¯·ç¨åé‡è¯•" });
        }
    }

    [HttpPost("send-with-retry")]
    public async Task<IActionResult> SendSmsWithRetry([FromBody] SendSmsRequest request)
    {
        var smsRequest = new SmsRequest
        {
            PhoneNumber = request.PhoneNumber,
            TemplateId = request.TemplateId,
            SignName = request.SignName,
            TemplateParams = request.TemplateParams
        };

        var response = await _smsService.SendSmsAsync(smsRequest);

        // æ™ºèƒ½é‡è¯•é€»è¾‘
        var retryCount = 0;
        var maxRetries = 3;

        while (!response.IsSuccess && response.IsRetryable && retryCount < maxRetries)
        {
            // æ ¹æ®é”™è¯¯ç±»å‹é€‰æ‹©åˆé€‚çš„å»¶è¿Ÿæ—¶é—´
            var delay = response.StandardErrorCode switch
            {
                StandardErrorCode.RateLimitExceeded => TimeSpan.FromMinutes(1),
                StandardErrorCode.NetworkError => TimeSpan.FromSeconds(5),
                StandardErrorCode.ProviderInternalError => TimeSpan.FromSeconds(10),
                _ => TimeSpan.FromSeconds(3)
            };

            _logger.LogInformation("é‡è¯•å‘é€çŸ­ä¿¡ï¼Œç¬¬{RetryCount}æ¬¡ï¼Œå»¶è¿Ÿ{Delay}ç§’",
                retryCount + 1, delay.TotalSeconds);

            await Task.Delay(delay);
            retryCount++;

            response = await _smsService.SendSmsAsync(smsRequest);
        }

        return response.IsSuccess
            ? Ok(new { success = true, provider = response.Provider, retryCount })
            : BadRequest(new { success = false, error = response.FriendlyErrorMessage, retryCount });
    }
}

public class SendSmsRequest
{
    public string PhoneNumber { get; set; }
    public string TemplateId { get; set; }
    public string SignName { get; set; }
    public Dictionary<string, string> TemplateParams { get; set; }
}
```

## é«˜çº§é…ç½®

### ç¯å¢ƒç‰¹å®šé…ç½®

ä¸ºä¸åŒç¯å¢ƒåˆ›å»ºä¸åŒçš„é…ç½®æ–‡ä»¶ï¼š

```
config/
â”œâ”€â”€ sms.json                 # é»˜è®¤é…ç½®
â”œâ”€â”€ sms.development.json     # å¼€å‘ç¯å¢ƒ
â”œâ”€â”€ sms.staging.json         # æµ‹è¯•ç¯å¢ƒ
â”œâ”€â”€ sms.production.json      # ç”Ÿäº§ç¯å¢ƒ
â””â”€â”€ sms.local.json          # æœ¬åœ°å¼€å‘ï¼ˆgitignoreï¼‰
```

**åŠ¨æ€åŠ è½½ç¯å¢ƒé…ç½®**ï¼š

```csharp
var environment = builder.Environment.EnvironmentName.ToLower();
var configFile = $"config/sms.{environment}.json";

// å¦‚æœç¯å¢ƒç‰¹å®šé…ç½®ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨é»˜è®¤é…ç½®
if (!File.Exists(configFile))
{
    configFile = "config/sms.json";
}

builder.Services.AddPolySmsFromConfigFile(configFile);
```

### é«˜çº§é…ç½®é€‰é¡¹

å®Œæ•´çš„é…ç½®æ–‡ä»¶ç¤ºä¾‹ï¼š

```json
{
  "Sms": {
    "DefaultProvider": "Aliyun",
    "EnableFailover": true,
    "ProviderPriority": ["Aliyun", "Tencent"],
    "RetryOptions": {
      "EnableRetry": true,
      "MaxRetryAttempts": 3,
      "RetryDelaySeconds": 5,
      "ExponentialBackoff": true,
      "RetryableErrorCodes": [
        "NetworkError",
        "ProviderInternalError",
        "RateLimitExceeded"
      ]
    },
    "Timeout": {
      "RequestTimeoutSeconds": 30,
      "OverallTimeoutSeconds": 120
    },
    "Monitoring": {
      "EnableMetrics": true,
      "EnableHealthCheck": true,
      "LogSuccessRequests": false,
      "LogFailedRequests": true
    }
  },
  "AliyunSms": {
    "AccessKeyId": "your-aliyun-access-key-id",
    "AccessKeySecret": "your-aliyun-access-key-secret",
    "Endpoint": "dysmsapi.aliyuncs.com",
    "RegionId": "cn-hangzhou"
  },
  "TencentSms": {
    "SecretId": "your-tencent-secret-id",
    "SecretKey": "your-tencent-secret-key",
    "Region": "ap-beijing",
    "SmsSdkAppId": "your-sms-sdk-app-id"
  }
}
```

### åˆ†ç¦»å¼é…ç½®

ä¸ºæ¯ä¸ªæä¾›å•†åˆ›å»ºç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ï¼š

```
config/
â”œâ”€â”€ sms.json           # æ ¸å¿ƒSMSé…ç½®
â”œâ”€â”€ aliyun.json        # é˜¿é‡Œäº‘é…ç½®
â””â”€â”€ tencent.json       # è…¾è®¯äº‘é…ç½®
```

**config/sms.json**ï¼š
```json
{
  "Sms": {
    "DefaultProvider": "Aliyun",
    "EnableFailover": true,
    "ProviderPriority": ["Aliyun", "Tencent"],
    "RetryOptions": {
      "EnableRetry": true,
      "MaxRetryAttempts": 3
    }
  }
}
```

**config/aliyun.json**ï¼š
```json
{
  "AliyunSms": {
    "AccessKeyId": "your-aliyun-access-key-id",
    "AccessKeySecret": "your-aliyun-access-key-secret",
    "Endpoint": "dysmsapi.aliyuncs.com"
  }
}
```

**config/tencent.json**ï¼š
```json
{
  "TencentSms": {
    "SecretId": "your-tencent-secret-id",
    "SecretKey": "your-tencent-secret-key",
    "Region": "ap-beijing",
    "SmsSdkAppId": "your-sms-sdk-app-id"
  }
}
```

**æœåŠ¡æ³¨å†Œ**ï¼š
```csharp
// PolySms æ”¯æŒç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ç®¡ç†ï¼Œè‡ªåŠ¨æ•´åˆå¤šä¸ªé…ç½®æ–‡ä»¶
var builder = WebApplication.CreateBuilder(args);

// æ–¹æ³•1: ç»Ÿä¸€é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
builder.Services.AddPolySmsFromConfigFile("config/sms.json");

// æ–¹æ³•2: å¤šé…ç½®æ–‡ä»¶æ–¹å¼
builder.Configuration.AddJsonFile("config/sms.json", optional: false, reloadOnChange: true)
                     .AddJsonFile("config/aliyun.json", optional: false, reloadOnChange: true)
                     .AddJsonFile("config/tencent.json", optional: false, reloadOnChange: true);

builder.Services.AddPolySms(builder.Configuration);
```

## å®‰å…¨æœ€ä½³å®è·µ

### 1. æ–‡ä»¶æƒé™æ§åˆ¶

```bash
# Linux/macOS è®¾ç½®æ–‡ä»¶æƒé™
chmod 600 config/sms.json           # åªæœ‰æ‰€æœ‰è€…å¯è¯»å†™
chown app-user:app-group config/sms.json  # è®¾ç½®æ–‡ä»¶æ‰€æœ‰è€…
```

### 2. ç‰ˆæœ¬æ§åˆ¶æ’é™¤

**.gitignore**ï¼š
```gitignore
# SMSé…ç½®æ–‡ä»¶
config/sms.local.json
config/sms.production.json
config/**/secrets.json

# æˆ–è€…æ’é™¤æ‰€æœ‰æ•æ„Ÿé…ç½®
config/sms*.json
!config/sms.template.json  # ä¿ç•™æ¨¡æ¿æ–‡ä»¶
```

### 3. é…ç½®æ¨¡æ¿æ–‡ä»¶

åˆ›å»º `config/sms.template.json` ä½œä¸ºé…ç½®æ¨¡æ¿ï¼š

```json
{
  "Sms": {
    "DefaultProvider": "Aliyun",
    "EnableFailover": true,
    "ProviderPriority": ["Aliyun", "Tencent"],
    "RetryOptions": {
      "EnableRetry": true,
      "MaxRetryAttempts": 3,
      "RetryDelaySeconds": 5
    }
  },
  "AliyunSms": {
    "AccessKeyId": "REPLACE_WITH_ALIYUN_ACCESS_KEY_ID",
    "AccessKeySecret": "REPLACE_WITH_ALIYUN_ACCESS_KEY_SECRET",
    "Endpoint": "dysmsapi.aliyuncs.com"
  },
  "TencentSms": {
    "SecretId": "REPLACE_WITH_TENCENT_SECRET_ID",
    "SecretKey": "REPLACE_WITH_TENCENT_SECRET_KEY",
    "Region": "ap-beijing",
    "SmsSdkAppId": "REPLACE_WITH_SMS_SDK_APP_ID"
  }
}
```

### 4. ç¯å¢ƒå˜é‡ç»“åˆä½¿ç”¨

```json
{
  "Sms": {
    "DefaultProvider": "${SMS_DEFAULT_PROVIDER:Aliyun}",
    "EnableFailover": "${SMS_ENABLE_FAILOVER:true}"
  },
  "AliyunSms": {
    "AccessKeyId": "${ALIYUN_ACCESS_KEY_ID}",
    "AccessKeySecret": "${ALIYUN_ACCESS_KEY_SECRET}"
  },
  "TencentSms": {
    "SecretId": "${TENCENT_SECRET_ID}",
    "SecretKey": "${TENCENT_SECRET_KEY}",
    "SmsSdkAppId": "${TENCENT_SMS_SDK_APP_ID}"
  }
}
```

## é…ç½®éªŒè¯å’Œç›‘æ§

### å¯åŠ¨æ—¶éªŒè¯é…ç½®

```csharp
using PolySms.Interfaces;
using PolySms.Options;
using PolySms.Enums;

public static class ConfigurationValidator
{
    public static async Task ValidateSmsConfiguration(IServiceProvider services)
    {
        var logger = services.GetRequiredService<ILogger<Program>>();
        var smsService = services.GetRequiredService<ISmsService>();

        try
        {
            logger.LogInformation("å¼€å§‹éªŒè¯PolySmsé…ç½®...");

            // æ£€æŸ¥å¯ç”¨çš„æä¾›å•†
            var availableProviders = smsService.GetAvailableProviders().ToList();
            logger.LogInformation("å¯ç”¨æä¾›å•†: {Providers}", string.Join(", ", availableProviders));

            foreach (var provider in availableProviders)
            {
                var isAvailable = smsService.IsProviderAvailable(provider);
                logger.LogInformation("æä¾›å•† {Provider}: {Status}",
                    provider, isAvailable ? "âœ… å¯ç”¨" : "âŒ ä¸å¯ç”¨");
            }

            // æµ‹è¯•è¿æ¥ï¼ˆå¯é€‰ï¼‰
            await TestProviderConnectivity(services, logger);

            logger.LogInformation("PolySmsé…ç½®éªŒè¯å®Œæˆ");
        }
        catch (Exception ex)
        {
            logger.LogError(ex, "PolySmsé…ç½®éªŒè¯å¤±è´¥");
            throw;
        }
    }

    private static async Task TestProviderConnectivity(IServiceProvider services, ILogger logger)
    {
        // è¿™é‡Œå¯ä»¥æ·»åŠ è¿é€šæ€§æµ‹è¯•é€»è¾‘
        // æ³¨æ„ï¼šå®é™…ç¯å¢ƒä¸­éœ€è¦è°¨æ…æµ‹è¯•ï¼Œé¿å…äº§ç”Ÿè´¹ç”¨
        logger.LogInformation("è·³è¿‡è¿é€šæ€§æµ‹è¯•ï¼ˆé¿å…äº§ç”Ÿè´¹ç”¨ï¼‰");
    }
}

// åœ¨Program.csä¸­ä½¿ç”¨
var app = builder.Build();

// éªŒè¯é…ç½®
using (var scope = app.Services.CreateScope())
{
    await ConfigurationValidator.ValidateSmsConfiguration(scope.ServiceProvider);
}

app.Run();
```

### å¥åº·æ£€æŸ¥é›†æˆ

```csharp
// æ·»åŠ å¥åº·æ£€æŸ¥
builder.Services.AddHealthChecks()
    .AddCheck<SmsHealthCheck>("sms");

// è‡ªå®šä¹‰å¥åº·æ£€æŸ¥
public class SmsHealthCheck : IHealthCheck
{
    private readonly ISmsService _smsService;
    private readonly ILogger<SmsHealthCheck> _logger;

    public SmsHealthCheck(ISmsService smsService, ILogger<SmsHealthCheck> logger)
    {
        _smsService = smsService;
        _logger = logger;
    }

    public Task<HealthCheckResult> CheckHealthAsync(
        HealthCheckContext context,
        CancellationToken cancellationToken = default)
    {
        try
        {
            var availableProviders = _smsService.GetAvailableProviders().ToList();

            if (!availableProviders.Any())
            {
                return Task.FromResult(HealthCheckResult.Unhealthy("æ²¡æœ‰å¯ç”¨çš„çŸ­ä¿¡æä¾›å•†"));
            }

            var healthData = new Dictionary<string, object>
            {
                ["availableProviders"] = availableProviders,
                ["providerCount"] = availableProviders.Count
            };

            return Task.FromResult(HealthCheckResult.Healthy("çŸ­ä¿¡æœåŠ¡æ­£å¸¸", healthData));
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "çŸ­ä¿¡æœåŠ¡å¥åº·æ£€æŸ¥å¤±è´¥");
            return Task.FromResult(HealthCheckResult.Unhealthy("çŸ­ä¿¡æœåŠ¡å¼‚å¸¸", ex));
        }
    }
}
```

## é…ç½®æ–‡ä»¶ç›‘å¬å’Œçƒ­é‡è½½

```csharp
// å¯ç”¨é…ç½®æ–‡ä»¶ç›‘å¬å’Œçƒ­é‡è½½
builder.Configuration.AddJsonFile("config/sms.json",
    optional: false,
    reloadOnChange: true);  // æ–‡ä»¶å˜æ›´æ—¶è‡ªåŠ¨é‡æ–°åŠ è½½

builder.Services.AddPolySms(builder.Configuration);

// ç›‘å¬é…ç½®å˜æ›´
builder.Services.Configure<SmsOptions>(
    builder.Configuration.GetSection("Sms"));

// æ·»åŠ é…ç½®å˜æ›´é€šçŸ¥
builder.Services.AddSingleton<IOptionsMonitor<SmsOptions>, OptionsMonitor<SmsOptions>>();
```

## å®¹å™¨åŒ–éƒ¨ç½²é…ç½®

### Dockerfile

```dockerfile
FROM mcr.microsoft.com/dotnet/aspnet:9.0

# åˆ›å»ºé…ç½®ç›®å½•
RUN mkdir -p /app/config

# å¤åˆ¶åº”ç”¨æ–‡ä»¶
COPY . /app
WORKDIR /app

# è®¾ç½®é…ç½®æ–‡ä»¶æƒé™
RUN chmod 600 /app/config/sms.json

EXPOSE 80
ENTRYPOINT ["dotnet", "YourApp.dll"]
```

### Docker Compose

```yaml
version: '3.8'
services:
  yourapp:
    build: .
    volumes:
      # å°†å®¿ä¸»æœºçš„é…ç½®æ–‡ä»¶æŒ‚è½½åˆ°å®¹å™¨
      - ./config/sms.production.json:/app/config/sms.json:ro
    environment:
      - ASPNETCORE_ENVIRONMENT=Production
      # ç¯å¢ƒå˜é‡æ–¹å¼ï¼ˆæ›´å®‰å…¨ï¼‰
      - ALIYUN_ACCESS_KEY_ID=${ALIYUN_ACCESS_KEY_ID}
      - ALIYUN_ACCESS_KEY_SECRET=${ALIYUN_ACCESS_KEY_SECRET}
      - TENCENT_SECRET_ID=${TENCENT_SECRET_ID}
      - TENCENT_SECRET_KEY=${TENCENT_SECRET_KEY}
    ports:
      - "8080:80"
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### Kubernetes é…ç½®

```yaml
# ConfigMap for SMS configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: sms-config
data:
  sms.json: |
    {
      "Sms": {
        "DefaultProvider": "Aliyun",
        "EnableFailover": true,
        "ProviderPriority": ["Aliyun", "Tencent"]
      }
    }

---
# Secret for sensitive data
apiVersion: v1
kind: Secret
metadata:
  name: sms-secrets
type: Opaque
stringData:
  ALIYUN_ACCESS_KEY_ID: "your-aliyun-access-key-id"
  ALIYUN_ACCESS_KEY_SECRET: "your-aliyun-access-key-secret"
  TENCENT_SECRET_ID: "your-tencent-secret-id"
  TENCENT_SECRET_KEY: "your-tencent-secret-key"

---
# Deployment
apiVersion: apps/v1
kind: Deployment
metadata:
  name: sms-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: sms-app
  template:
    metadata:
      labels:
        app: sms-app
    spec:
      containers:
      - name: sms-app
        image: your-app:latest
        ports:
        - containerPort: 80
        env:
        - name: ALIYUN_ACCESS_KEY_ID
          valueFrom:
            secretKeyRef:
              name: sms-secrets
              key: ALIYUN_ACCESS_KEY_ID
        - name: ALIYUN_ACCESS_KEY_SECRET
          valueFrom:
            secretKeyRef:
              name: sms-secrets
              key: ALIYUN_ACCESS_KEY_SECRET
        - name: TENCENT_SECRET_ID
          valueFrom:
            secretKeyRef:
              name: sms-secrets
              key: TENCENT_SECRET_ID
        - name: TENCENT_SECRET_KEY
          valueFrom:
            secretKeyRef:
              name: sms-secrets
              key: TENCENT_SECRET_KEY
        volumeMounts:
        - name: config-volume
          mountPath: /app/config
          readOnly: true
        livenessProbe:
          httpGet:
            path: /health
            port: 80
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health/ready
            port: 80
          initialDelaySeconds: 5
          periodSeconds: 5
      volumes:
      - name: config-volume
        configMap:
          name: sms-config
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°**
   ```
   é”™è¯¯: Unable to find config file 'config/sms.json'
   è§£å†³: ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®ï¼Œæˆ–è®¾ç½® optional: true
   ```

2. **é…ç½®æ ¼å¼é”™è¯¯**
   ```
   é”™è¯¯: JSON format error in config file
   è§£å†³: ä½¿ç”¨JSONéªŒè¯å·¥å…·æ£€æŸ¥æ–‡ä»¶æ ¼å¼
   ```

3. **æƒé™ä¸è¶³**
   ```
   é”™è¯¯: Access denied to config file
   è§£å†³: æ£€æŸ¥æ–‡ä»¶æƒé™è®¾ç½®
   ```

4. **ç¯å¢ƒå˜é‡æœªç”Ÿæ•ˆ**
   ```
   é”™è¯¯: Environment variables not replaced
   è§£å†³: ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ç¯å¢ƒå˜é‡æ ¼å¼ ${VAR_NAME:defaultValue}
   ```

### è°ƒè¯•é…ç½®åŠ è½½

```csharp
using PolySms.Extensions;
using PolySms.Options;

builder.Services.AddPolySmsFromConfigFile("config/sms.json");

// æ·»åŠ é…ç½®è°ƒè¯•è¾“å‡º
builder.Services.PostConfigure<SmsOptions>(options =>
{
    var logger = LoggerFactory.Create(b => b.AddConsole()).CreateLogger<Program>();

    logger.LogInformation("PolySmsé…ç½®åŠ è½½å®Œæˆ:");
    logger.LogInformation("- é»˜è®¤æä¾›å•†: {DefaultProvider}", options.DefaultProvider);
    logger.LogInformation("- æ•…éšœè½¬ç§»: {EnableFailover}", options.EnableFailover);
    logger.LogInformation("- æä¾›å•†ä¼˜å…ˆçº§: {Priority}",
        string.Join(", ", options.ProviderPriority));

    if (options.RetryOptions != null)
    {
        logger.LogInformation("- é‡è¯•é…ç½®: å¯ç”¨={Enabled}, æœ€å¤§é‡è¯•={MaxRetries}",
            options.RetryOptions.EnableRetry, options.RetryOptions.MaxRetryAttempts);
    }
});
```

### é”™è¯¯å¤„ç†æµ‹è¯•

```csharp
// åˆ›å»ºæµ‹è¯•æœåŠ¡
public class SmsConfigurationTestService
{
    private readonly ISmsService _smsService;
    private readonly ILogger<SmsConfigurationTestService> _logger;

    public SmsConfigurationTestService(
        ISmsService smsService,
        ILogger<SmsConfigurationTestService> logger)
    {
        _smsService = smsService;
        _logger = logger;
    }

    public async Task TestErrorHandling()
    {
        // æµ‹è¯•ä¸åŒçš„é”™è¯¯åœºæ™¯
        var testCases = new[]
        {
            ("", "SMS_001", "æµ‹è¯•ç­¾å", new Dictionary<string, string>()),  // æ— æ•ˆæ‰‹æœºå·
            ("13800138000", "", "æµ‹è¯•ç­¾å", new Dictionary<string, string>()),  // æ— æ•ˆæ¨¡æ¿
            ("13800138000", "SMS_001", "", new Dictionary<string, string>())   // æ— æ•ˆç­¾å
        };

        foreach (var (phone, template, sign, parameters) in testCases)
        {
            try
            {
                var request = new SmsRequest
                {
                    PhoneNumber = phone,
                    TemplateId = template,
                    SignName = sign,
                    TemplateParams = parameters
                };

                var response = await _smsService.SendSmsAsync(request);

                _logger.LogInformation("æµ‹è¯•ç»“æœ: æ‰‹æœºå·={Phone}, æˆåŠŸ={Success}, é”™è¯¯ç ={ErrorCode}, é”™è¯¯ä¿¡æ¯={ErrorMessage}",
                    phone, response.IsSuccess, response.StandardErrorCode, response.FriendlyErrorMessage);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex, "æµ‹è¯•å¼‚å¸¸: æ‰‹æœºå·={Phone}", phone);
            }
        }
    }
}
```

## æ€»ç»“

ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶çš„ä¼˜åŠ¿ï¼š

### ğŸ“¦ æŠ€æœ¯ä¼˜åŠ¿
1. **ğŸš€ è½»é‡çº§æ¶æ„** - HTTPç›´è¿ï¼Œé›¶ç¬¬ä¸‰æ–¹SDKä¾èµ–
2. **âš¡ é«˜æ€§èƒ½** - åŒ…ä½“ç§¯å‡å°‘99.96%ï¼Œå¯åŠ¨é€Ÿåº¦æå‡80%
3. **ğŸ›¡ï¸ æ ‡å‡†åŒ–é”™è¯¯å¤„ç†** - ç»Ÿä¸€é”™è¯¯ç ç³»ç»Ÿï¼Œæ™ºèƒ½é‡è¯•æœºåˆ¶
4. **ğŸ”„ æ™ºèƒ½æ•…éšœè½¬ç§»** - å¤šæä¾›å•†è‡ªåŠ¨åˆ‡æ¢

### ğŸ”’ é…ç½®ç®¡ç†ä¼˜åŠ¿
1. **æ›´å¥½çš„å®‰å…¨æ€§** - ç‹¬ç«‹çš„é…ç½®æ–‡ä»¶ä¾¿äºæƒé™ç®¡ç†
2. **æ¸…æ™°çš„ç»„ç»‡ç»“æ„** - é…ç½®æ–‡ä»¶åˆ†ç¦»ï¼ŒèŒè´£æ˜ç¡®
3. **çµæ´»çš„ç¯å¢ƒç®¡ç†** - ä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®æ–‡ä»¶
4. **ä¾¿äºç»´æŠ¤** - é…ç½®å˜æ›´ä¸å½±å“ä¸»åº”ç”¨é…ç½®
5. **çƒ­é‡è½½æ”¯æŒ** - é…ç½®å˜æ›´å¯ä»¥åŠ¨æ€ç”Ÿæ•ˆ

### ğŸŒŸ ä¼ä¸šçº§ç‰¹æ€§
1. **å®Œå–„çš„ç›‘æ§** - å¥åº·æ£€æŸ¥ã€æŒ‡æ ‡æ”¶é›†ã€æ—¥å¿—è®°å½•
2. **å®¹å™¨åŒ–æ”¯æŒ** - Dockerã€Kuberneteså®Œæ•´éƒ¨ç½²æ–¹æ¡ˆ
3. **é”™è¯¯å¤„ç†** - è¯¦ç»†çš„é”™è¯¯åˆ†ç±»å’Œå‹å¥½çš„é”™è¯¯ä¿¡æ¯
4. **æ™ºèƒ½é‡è¯•** - åŸºäºé”™è¯¯ç±»å‹çš„æ™ºèƒ½é‡è¯•ç­–ç•¥

æ¨èåœ¨ç”Ÿäº§ç¯å¢ƒå’Œä¼ä¸šåº”ç”¨ä¸­ä½¿ç”¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶æ–¹å¼æ¥ç®¡ç†PolySmsé…ç½®ã€‚

## âš¡ PolySms ç›¸æ¯”ä¼ ç»ŸSDKçš„ä¼˜åŠ¿

### ğŸ“¦ è½»é‡çº§æ¶æ„
- **é›¶ç¬¬ä¸‰æ–¹SDKä¾èµ–**ï¼šæ— éœ€é˜¿é‡Œäº‘å’Œè…¾è®¯äº‘çš„åšé‡SDKåŒ…
- **åŒ…ä½“ç§¯æå°**ï¼šä»ä¼ ç»Ÿçš„50MBå‡å°‘åˆ°çº¦20KBï¼ˆ99.96%å‡å°‘ï¼‰
- **é…ç½®æ›´ç®€å•**ï¼šç»Ÿä¸€çš„é…ç½®æ ¼å¼ï¼Œæ— éœ€åˆ†åˆ«é…ç½®å¤šä¸ªSDK

### ğŸš€ æ€§èƒ½ä¼˜åŠ¿
- **å¯åŠ¨æ›´å¿«**ï¼šæ— éœ€åŠ è½½å¤§å‹SDKç¨‹åºé›†
- **å†…å­˜å ç”¨æ›´å°‘**ï¼šHTTPç›´æ¥è°ƒç”¨ï¼Œå‡å°‘80%å†…å­˜å¼€é”€
- **éƒ¨ç½²ä½“ç§¯æ›´å°**ï¼šDockeré•œåƒå’Œéƒ¨ç½²åŒ…å¤§å¹…å‡å°

### ğŸ”§ æŠ€æœ¯å®ç°
- **HTTPç›´æ¥è°ƒç”¨**ï¼šç»•è¿‡SDKï¼Œç›´æ¥è°ƒç”¨äº‘æœåŠ¡API
- **è‡ªç ”ç­¾åç®—æ³•**ï¼šå†…ç½®é˜¿é‡Œäº‘RPCå’Œè…¾è®¯äº‘TC3-HMAC-SHA256ç­¾å
- **ç»Ÿä¸€æŠ½è±¡æ¥å£**ï¼šä¸ºä¸åŒäº‘å‚å•†æä¾›ä¸€è‡´çš„ä½¿ç”¨ä½“éªŒ
- **æ ‡å‡†åŒ–é”™è¯¯å¤„ç†**ï¼šErrorCodeMapperç»Ÿä¸€å¤„ç†ä¸åŒæä¾›å•†çš„é”™è¯¯ç 

### ğŸ›¡ï¸ å®‰å…¨ä¼˜åŠ¿
- **æ— ç¬¬ä¸‰æ–¹ä¾èµ–é£é™©**ï¼šé¿å…ç¬¬ä¸‰æ–¹SDKçš„å®‰å…¨æ¼æ´
- **è‡ªä¸»å¯æ§**ï¼šæ ¸å¿ƒé€»è¾‘å®Œå…¨è‡ªä¸»å®ç°
- **é€æ˜çš„å®‰å…¨å®ç°**ï¼šå¼€æºä»£ç ï¼Œå®‰å…¨å®ç°å®Œå…¨é€æ˜

### ğŸ”„ æ— ç¼è¿ç§»
ä»ä¼ ç»ŸSDKè¿ç§»åˆ°PolySmsï¼Œé…ç½®æ–‡ä»¶æ ¼å¼ç®€å•ç›´è§‚ï¼Œè¿ç§»æˆæœ¬æä½ï¼