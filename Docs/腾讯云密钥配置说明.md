# 腾讯云短信密钥配置说明

## 概述

腾讯云短信服务存在**两套不同的认证体系**，这经常导致开发者在配置时产生混淆。本文档详细解释这两套体系的区别，以及 PolySms 项目中应该使用哪套密钥。

## 📋 重要提示

⚠️ **常见误区**：很多开发者以为短信控制台中显示的"SecretKey"就是项目所需的密钥，但实际上这是两个完全不同的概念！

## 🔐 腾讯云短信的双重认证体系

### 1. 应用级密钥（短信控制台显示）

**位置**：腾讯云控制台 → 短信 → 应用管理

**包含参数**：
- **SdkAppId** - 短信应用ID（如：1400009099）
- **AppKey** - 应用级密钥（用于旧版SDK）

**用途**：
- 旧版短信SDK
- 简化的短信接口
- 直接HTTP签名调用

**特点**：
- 应用级别，每个短信应用有独立的密钥
- 主要用于向后兼容

### 2. 账号级API密钥（PolySms使用的）

**位置**：腾讯云控制台 → 访问管理 → API密钥管理

**包含参数**：
- **SecretId** - 腾讯云账号API密钥ID
- **SecretKey** - 腾讯云账号API密钥

**用途**：
- 新版API接口（如SendSms API）
- 腾讯云所有服务的统一认证
- 云API签名方法v3

**特点**：
- 账号级别，适用于所有腾讯云服务
- 更安全的签名方法
- **这是PolySms项目使用的认证方式**

## 🎯 PolySms项目配置

### 需要的参数

PolySms使用新版API调用方式，需要以下3个参数：

```json
{
  "TencentSms": {
    "SecretId": "您的腾讯云API密钥ID",
    "SecretKey": "您的腾讯云API密钥",
    "SmsSdkAppId": "您的短信应用ID",
    "Region": "ap-beijing"
  }
}
```

### 参数获取方法

#### 1. 获取 SecretId 和 SecretKey

1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 进入 **访问管理** → **[API密钥管理](https://console.cloud.tencent.com/cam/capi)**
3. 点击 **新建密钥**（如果已有密钥可直接使用）
4. 复制 **SecretId** 和 **SecretKey**

⚠️ **安全提醒**：SecretKey只在创建时显示一次，请妥善保存！

#### 2. 获取 SmsSdkAppId

1. 进入 **短信** → **[应用管理](https://console.cloud.tencent.com/smsv2/app-manage)**
2. 查看或创建短信应用
3. 复制 **SDK AppID**

## 🔍 常见问题解答

### Q: 短信控制台的"SecretKey"和API密钥的"SecretKey"有什么区别？

**A**: 它们是完全不同的两个概念：
- **短信控制台的"SecretKey"** = 实际是AppKey，用于旧版SDK
- **API密钥的"SecretKey"** = 腾讯云账号级密钥，用于新版API

### Q: 为什么不能只用短信应用的密钥？

**A**: PolySms使用的是腾讯云新版API接口（SendSms），这个接口要求使用账号级的API密钥进行签名认证，而不是应用级的AppKey。

### Q: 我已经有短信应用了，还需要创建API密钥吗？

**A**: 是的，需要。短信应用提供SmsSdkAppId，API密钥管理提供SecretId和SecretKey，两者缺一不可。

### Q: 一个腾讯云账号可以有多个API密钥吗？

**A**: 可以，主账号最多可以创建2个API密钥，建议为不同项目使用不同的密钥。

## 📝 配置示例

### appsettings.json 配置

```json
{
  "TencentSms": {
    "SecretId": "AKID1234567890abcdefg",
    "SecretKey": "abcdefg1234567890AKID",
    "SmsSdkAppId": "1400009099",
    "Region": "ap-beijing"
  }
}
```

### 环境变量配置（推荐用于生产环境）

```bash
export TENCENTCLOUD_SECRET_ID="AKID1234567890abcdefg"
export TENCENTCLOUD_SECRET_KEY="abcdefg1234567890AKID"
export TENCENT_SMS_SDK_APP_ID="1400009099"
```

## 🛡️ 安全最佳实践

1. **永远不要将密钥硬编码到代码中**
2. **使用环境变量或安全的配置管理服务**
3. **定期轮换API密钥**
4. **为不同环境使用不同的密钥**
5. **限制API密钥的权限范围**

## 🔗 相关链接

- [腾讯云API密钥管理](https://console.cloud.tencent.com/cam/capi)
- [短信应用管理](https://console.cloud.tencent.com/smsv2/app-manage)
- [腾讯云短信API文档](https://cloud.tencent.com/document/product/382/43194)
- [API签名方法v3](https://cloud.tencent.com/document/api/382/52071)

---

如果您在配置过程中遇到问题，请参考项目的其他文档或提交Issue。