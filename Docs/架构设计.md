# PolySms æ¶æ„è®¾è®¡æ–‡æ¡£

## æ¦‚è¿°

PolySmsé‡‡ç”¨**è½»é‡çº§HTTPç›´è¿æ¶æ„**ï¼Œæ”¾å¼ƒä¼ ç»Ÿçš„åšé‡SDKä¾èµ–ï¼Œé€šè¿‡è‡ªç ”HTTPç­¾åç®—æ³•ç›´æ¥è°ƒç”¨äº‘æœåŠ¡APIã€‚è¿™ç§æ¶æ„å¤§å¹…å‡å°‘åŒ…ä½“ç§¯ï¼ˆ99.96%ï¼‰ï¼Œæ˜¾è‘—æå‡å¯åŠ¨æ€§èƒ½ï¼ŒåŒæ—¶ä¿æŒå®Œæ•´çš„åŠŸèƒ½æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ—ï¸ æ•´ä½“æ¶æ„

### æ–°æ¶æ„å¯¹æ¯”

```
ä¼ ç»ŸSDKæ¶æ„ (PolySms):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Core Layer                           â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚   SmsService    â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Provider Layer                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ AliyunProvider  â”‚         â”‚ TencentProvider â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              External SDK Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  AlibabaCloud   â”‚         â”‚  TencentCloud   â”‚        â”‚
â”‚  â”‚   SDK (~20MB)   â”‚         â”‚   SDK (~30MB)   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Cloud APIs                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Aliyun SMS    â”‚         â”‚  Tencent SMS    â”‚        â”‚
â”‚  â”‚      API        â”‚         â”‚      API        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

PolySmsæ¶æ„ (New):
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Application Layer                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Core Layer                           â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚   SmsService    â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              HTTP Provider Layer                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ AliyunProvider  â”‚         â”‚ TencentProvider â”‚        â”‚
â”‚  â”‚ + RPC Signature â”‚         â”‚ + TC3 Signature â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              HTTP Client Layer                          â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚              â”‚  HttpSmsClient  â”‚                        â”‚
â”‚              â”‚   (.NETå†…ç½®)     â”‚                        â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Cloud APIs                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚   Aliyun SMS    â”‚         â”‚  Tencent SMS    â”‚        â”‚
â”‚  â”‚      API        â”‚         â”‚      API        â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ¶æ„ä¼˜åŠ¿

| å¯¹æ¯”é¡¹ | ä¼ ç»ŸSDKæ¶æ„ | PolySms HTTPæ¶æ„ | ä¼˜åŠ¿ |
|--------|-------------|------------------|------|
| **å±‚çº§å¤æ‚åº¦** | 5å±‚ | 4å±‚ | å‡å°‘1å±‚æŠ½è±¡ |
| **å¤–éƒ¨ä¾èµ–** | 2ä¸ªå¤§å‹SDK | 0ä¸ª | é›¶ä¾èµ– |
| **åŒ…ä½“ç§¯** | ~50MB | ~20KB | **99.96%å‡å°‘** |
| **å¯åŠ¨æ—¶é—´** | 2-3ç§’ | 0.2-0.3ç§’ | **90%å‡å°‘** |
| **è°ƒç”¨é“¾è·¯** | Appâ†’Coreâ†’Providerâ†’SDKâ†’API | Appâ†’Coreâ†’Providerâ†’HTTPâ†’API | **æ›´ç›´æ¥** |

## ğŸ”§ æ ¸å¿ƒç»„ä»¶è®¾è®¡

### 1. HTTPç›´è¿å±‚ (HTTP Direct Layer)

```csharp
namespace PolySms.Providers.Http;

// HTTPå®¢æˆ·ç«¯æŠ½è±¡
public interface IHttpSmsClient
{
    Task<HttpResponseMessage> PostAsync(
        string url,
        Dictionary<string, string> headers,
        string content,
        CancellationToken cancellationToken = default);
}

// HTTPå®¢æˆ·ç«¯å®ç°
public class HttpSmsClient : IHttpSmsClient
{
    private readonly HttpClient _httpClient;
    private readonly ILogger<HttpSmsClient> _logger;

    // ä½¿ç”¨.NETå†…ç½®HttpClientï¼Œé›¶å¤–éƒ¨ä¾èµ–
    // ç»Ÿä¸€è¶…æ—¶ã€é‡è¯•ã€æ—¥å¿—è®°å½•
}
```

### 2. ç­¾åç®—æ³•å±‚ (Signature Layer)

#### é˜¿é‡Œäº‘RPCç­¾åç®—æ³•
```csharp
namespace PolySms.Providers.Aliyun;

public static class AliyunSignatureHelper
{
    // å®ç°é˜¿é‡Œäº‘RPC Signature V1.0
    // - å‚æ•°æ’åºå’ŒURLç¼–ç 
    // - HMAC-SHA1ç­¾åè®¡ç®—
    // - å®Œæ•´è¯·æ±‚URLæ„å»º

    public static (string Url, Dictionary<string, string> Headers) BuildRequest(
        string endpoint,
        string accessKeyId,
        string accessKeySecret,
        Dictionary<string, string> parameters)
    {
        // 1. æ·»åŠ å…¬å…±å‚æ•°
        // 2. å‚æ•°æ’åºå’Œç¼–ç 
        // 3. æ„é€ ç­¾åå­—ç¬¦ä¸²
        // 4. HMAC-SHA1è®¡ç®—ç­¾å
        // 5. æ„é€ æœ€ç»ˆURL
    }
}
```

#### è…¾è®¯äº‘TC3ç­¾åç®—æ³•
```csharp
namespace PolySms.Providers.Tencent;

public static class TencentSignatureHelper
{
    // å®ç°è…¾è®¯äº‘TC3-HMAC-SHA256ç­¾åç®—æ³•
    // - Canonical Requestæ„å»º
    // - String to Signç”Ÿæˆ
    // - ç­¾åè®¡ç®—å’ŒAuthorization headeræ„å»º

    public static (string Url, Dictionary<string, string> Headers, string Body) BuildRequest(
        string region,
        string secretId,
        string secretKey,
        object requestData)
    {
        // 1. æ„å»ºCanonical Request
        // 2. åˆ›å»ºString to Sign
        // 3. è®¡ç®—ç­¾å
        // 4. æ„å»ºAuthorization header
    }
}
```

### 3. æä¾›å•†é€‚é…å±‚ (Provider Adapter Layer)

```csharp
namespace PolySms.Providers.Aliyun;

public class AliyunSmsProvider : ISmsProvider
{
    private readonly AliyunSmsOptions _options;
    private readonly IHttpSmsClient _httpClient;

    public async Task<SmsResponse> SendSmsAsync(SmsRequest request, CancellationToken cancellationToken)
    {
        // 1. å‚æ•°è½¬æ¢ï¼šç»Ÿä¸€æ¨¡å‹ â†’ é˜¿é‡Œäº‘APIå‚æ•°
        var parameters = MapToAliyunParameters(request);

        // 2. ç­¾åè®¡ç®—ï¼šè°ƒç”¨AliyunSignatureHelper
        var (url, headers) = AliyunSignatureHelper.BuildRequest(
            _options.Endpoint, _options.AccessKeyId, _options.AccessKeySecret, parameters);

        // 3. HTTPè°ƒç”¨ï¼šé€šè¿‡HttpSmsClientå‘é€è¯·æ±‚
        var response = await _httpClient.PostAsync(url, headers, string.Empty, cancellationToken);

        // 4. ç»“æœè½¬æ¢ï¼šé˜¿é‡Œäº‘å“åº” â†’ ç»Ÿä¸€æ¨¡å‹
        return MapToUnifiedResponse(response);
    }
}
```

## ğŸš€ å…³é”®æŠ€æœ¯å®ç°

### 1. ç­¾åç®—æ³•è‡ªç ”

**è®¾è®¡å†³ç­–**ï¼šä¸ºä»€ä¹ˆè‡ªç ”è€Œä¸ç”¨SDKï¼Ÿ

| è€ƒè™‘å› ç´  | SDKæ–¹æ¡ˆ | è‡ªç ”æ–¹æ¡ˆ | ç»“è®º |
|----------|---------|----------|------|
| **å¤æ‚åº¦** | é»‘ç›’ï¼Œéš¾ä»¥è°ƒè¯• | é€æ˜ï¼Œå¯æ§ | âœ… è‡ªç ” |
| **ä½“ç§¯** | 20-30MB/ä¸ª | å‡ KB | âœ… è‡ªç ” |
| **ä¾èµ–** | å¼•å…¥å¤§é‡é—´æ¥ä¾èµ– | é›¶ä¾èµ– | âœ… è‡ªç ” |
| **ç»´æŠ¤** | å—åˆ¶äºSDKæ›´æ–° | å®Œå…¨è‡ªä¸» | âœ… è‡ªç ” |
| **æ€§èƒ½** | åŠ è½½æ—¶é—´é•¿ | å¯åŠ¨å³ç”¨ | âœ… è‡ªç ” |

**å®ç°ç­–ç•¥**ï¼š
- é˜¿é‡Œäº‘ï¼šåŸºäºå®˜æ–¹APIæ–‡æ¡£å®ç°RPCç­¾åç®—æ³•
- è…¾è®¯äº‘ï¼šåŸºäºå®˜æ–¹APIæ–‡æ¡£å®ç°TC3-HMAC-SHA256ç®—æ³•
- éªŒè¯ï¼šå¯¹ç…§å®˜æ–¹ç¤ºä¾‹éªŒè¯ç­¾åæ­£ç¡®æ€§

### 2. HTTPå®¢æˆ·ç«¯ç»Ÿä¸€

```csharp
// ç»Ÿä¸€çš„HTTPè°ƒç”¨æ¥å£
public interface IHttpSmsClient
{
    Task<HttpResponseMessage> PostAsync(string url, Dictionary<string, string> headers,
                                       string content, CancellationToken cancellationToken = default);
}

// å®ç°ç‰¹æ€§ï¼š
// - ç»Ÿä¸€è¶…æ—¶è®¾ç½®ï¼ˆ30ç§’ï¼‰
// - è‡ªåŠ¨é‡è¯•æœºåˆ¶
// - ç»“æ„åŒ–æ—¥å¿—è®°å½•
// - å¼‚å¸¸ç»Ÿä¸€å¤„ç†
```

### 3. å“åº”ç»Ÿä¸€å¤„ç†

```csharp
// ç»Ÿä¸€å“åº”æ¨¡å‹
public class SmsResponse
{
    public bool IsSuccess { get; set; }
    public string RequestId { get; set; } = string.Empty;
    public string BizId { get; set; } = string.Empty;
    public string ErrorCode { get; set; } = string.Empty;
    public string ErrorMessage { get; set; } = string.Empty;
    public string Provider { get; set; } = string.Empty;
}

// å„æä¾›å•†å“åº”æ˜ å°„ï¼š
// é˜¿é‡Œäº‘ï¼šCode="OK" â†’ IsSuccess=true
// è…¾è®¯äº‘ï¼šSendStatusSet[0].Code="Ok" â†’ IsSuccess=true
```

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–è®¾è®¡

### 1. å¯åŠ¨æ—¶é—´ä¼˜åŒ–

**é—®é¢˜**ï¼šä¼ ç»ŸSDKéœ€è¦åŠ è½½å¤§é‡ç¨‹åºé›†
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ç§»é™¤æ‰€æœ‰ç¬¬ä¸‰æ–¹SDKä¾èµ–
- ä½¿ç”¨.NETå†…ç½®ç±»å‹å’ŒHTTPå®¢æˆ·ç«¯
- æ‡’åŠ è½½é…ç½®å’ŒæœåŠ¡

**æ•ˆæœ**ï¼š
```
ä¼ ç»Ÿæ–¹æ¡ˆå¯åŠ¨æ—¶é—´åˆ†æï¼š
â”œâ”€â”€ SDKç¨‹åºé›†åŠ è½½: 1.5-2.0s
â”œâ”€â”€ ä¾èµ–è§£æ: 0.3-0.5s
â”œâ”€â”€ é…ç½®åˆå§‹åŒ–: 0.2s
â””â”€â”€ æ€»è®¡: 2.0-2.7s

PolySmså¯åŠ¨æ—¶é—´åˆ†æï¼š
â”œâ”€â”€ æ ¸å¿ƒç¨‹åºé›†åŠ è½½: 0.1s
â”œâ”€â”€ é…ç½®åˆå§‹åŒ–: 0.1s
â””â”€â”€ æ€»è®¡: 0.2s

æ”¹å–„ï¼š90%å¯åŠ¨æ—¶é—´å‡å°‘
```

### 2. å†…å­˜å ç”¨ä¼˜åŒ–

**é—®é¢˜**ï¼šSDKå¸¦æ¥å¤§é‡å†…å­˜å¼€é”€
**è§£å†³æ–¹æ¡ˆ**ï¼š
- æ— é™æ€ä¾èµ–ç¼“å­˜
- æŒ‰éœ€åˆ›å»ºHTTPå®¢æˆ·ç«¯
- è½»é‡çº§é…ç½®å¯¹è±¡

**æ•ˆæœ**ï¼š
```
å†…å­˜å ç”¨å¯¹æ¯”ï¼ˆè¿è¡Œæ—¶ï¼‰ï¼š
â”œâ”€â”€ ä¼ ç»Ÿæ–¹æ¡ˆ: 50-80MB
â”œâ”€â”€ PolySms: 10-15MB
â””â”€â”€ å‡å°‘: 70-80%
```

### 3. ç½‘ç»œæ€§èƒ½ä¼˜åŒ–

```csharp
public class HttpSmsClient : IHttpSmsClient
{
    public HttpSmsClient(HttpClient httpClient, ILogger<HttpSmsClient> logger)
    {
        _httpClient = httpClient;

        // æ€§èƒ½ä¼˜åŒ–é…ç½®
        _httpClient.Timeout = TimeSpan.FromSeconds(30);
        // å¤ç”¨è¿æ¥æ± 
        // è‡ªåŠ¨è§£å‹ç¼©
        // Keep-Alive
    }
}
```

## ğŸ›¡ï¸ å¯é æ€§è®¾è®¡

### 1. æ•…éšœè½¬ç§»æœºåˆ¶

```csharp
public class SmsService : ISmsService
{
    public async Task<SmsResponse> SendSmsAsync(SmsRequest request, CancellationToken cancellationToken)
    {
        var response = await SendSmsAsync(request, _smsOptions.DefaultProvider, cancellationToken);

        // æ•…éšœè½¬ç§»é€»è¾‘
        if (!response.IsSuccess && _smsOptions.EnableFailover)
        {
            foreach (var providerName in _smsOptions.ProviderPriority.Where(p => p != _smsOptions.DefaultProvider))
            {
                if (IsProviderAvailable(providerName))
                {
                    response = await SendSmsAsync(request, providerName, cancellationToken);
                    if (response.IsSuccess) break;
                }
            }
        }

        return response;
    }
}
```

### 2. é”™è¯¯å¤„ç†ç­–ç•¥

```csharp
// åˆ†å±‚é”™è¯¯å¤„ç†ï¼š
// 1. HTTPå±‚é”™è¯¯ â†’ EXCEPTION
// 2. APIå±‚é”™è¯¯ â†’ åŸå§‹é”™è¯¯ç 
// 3. ä¸šåŠ¡å±‚é”™è¯¯ â†’ ç»Ÿä¸€é”™è¯¯ç 

try
{
    var response = await provider.SendSmsAsync(request, cancellationToken);
    return response;
}
catch (HttpRequestException ex)
{
    return new SmsResponse
    {
        IsSuccess = false,
        ErrorCode = "HTTP_ERROR",
        ErrorMessage = ex.Message,
        Provider = provider.ProviderName
    };
}
catch (TaskCanceledException ex)
{
    return new SmsResponse
    {
        IsSuccess = false,
        ErrorCode = "TIMEOUT",
        ErrorMessage = "Request timeout",
        Provider = provider.ProviderName
    };
}
```

### 3. æ—¥å¿—è®°å½•è®¾è®¡

```csharp
// ç»“æ„åŒ–æ—¥å¿—è®°å½•
_logger.LogDebug("Sending SMS via {Provider} to {PhoneNumber} with template {TemplateId}",
    provider.ProviderName, request.PhoneNumber, request.TemplateId);

_logger.LogInformation("SMS sent successfully via {Provider}, RequestId: {RequestId}",
    provider.ProviderName, response.RequestId);

_logger.LogWarning("SMS failed via {Provider}, Error: {ErrorCode} - {ErrorMessage}",
    provider.ProviderName, response.ErrorCode, response.ErrorMessage);
```

## ğŸ”§ å¯æ‰©å±•æ€§è®¾è®¡

### 1. æ–°æä¾›å•†æ‰©å±•

```csharp
// åªéœ€å®ç°ISmsProvideræ¥å£
public class NewCloudSmsProvider : ISmsProvider
{
    public string ProviderName => "NewCloud";

    public async Task<SmsResponse> SendSmsAsync(SmsRequest request, CancellationToken cancellationToken)
    {
        // 1. å®ç°ç­¾åç®—æ³•
        var (url, headers, body) = NewCloudSignatureHelper.BuildRequest(...);

        // 2. HTTPè°ƒç”¨
        var response = await _httpClient.PostAsync(url, headers, body, cancellationToken);

        // 3. å“åº”è½¬æ¢
        return MapToUnifiedResponse(response);
    }
}

// æ³¨å†Œåˆ°DIå®¹å™¨
services.AddScoped<ISmsProvider, NewCloudSmsProvider>();
```

### 2. ç­¾åç®—æ³•æ‰©å±•

```csharp
// æ–°çš„ç­¾åç®—æ³•åªéœ€å®ç°æ ‡å‡†æ¥å£
public static class NewCloudSignatureHelper
{
    public static (string Url, Dictionary<string, string> Headers, string Body) BuildRequest(
        string region,
        string accessKey,
        string secretKey,
        object requestData)
    {
        // å®ç°æ–°äº‘æœåŠ¡å•†çš„ç­¾åç®—æ³•
        // è¿”å›æ ‡å‡†æ ¼å¼çš„è¯·æ±‚æ•°æ®
    }
}
```

## ğŸ¯ è®¾è®¡æ¨¡å¼åº”ç”¨

### 1. é€‚é…å™¨æ¨¡å¼ (Adapter Pattern)
- **ç›®çš„**ï¼šç»Ÿä¸€ä¸åŒäº‘æœåŠ¡å•†çš„APIæ¥å£
- **å®ç°**ï¼šå„Providerå°†äº‘æœåŠ¡å•†ç‰¹æœ‰çš„APIé€‚é…ä¸ºç»Ÿä¸€çš„ISmsProvideræ¥å£

### 2. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)
- **ç›®çš„**ï¼šè¿è¡Œæ—¶é€‰æ‹©ä¸åŒçš„çŸ­ä¿¡æœåŠ¡æä¾›å•†
- **å®ç°**ï¼šSmsServiceæ ¹æ®é…ç½®æˆ–å‚æ•°é€‰æ‹©ç›¸åº”çš„Providerå®ç°

### 3. å·¥å‚æ¨¡å¼ (Factory Pattern)
- **ç›®çš„**ï¼šåˆ›å»ºå’Œç®¡ç†Providerå®ä¾‹
- **å®ç°**ï¼šé€šè¿‡DIå®¹å™¨ç®¡ç†Providerçš„ç”Ÿå‘½å‘¨æœŸ

### 4. æ¨¡æ¿æ–¹æ³•æ¨¡å¼ (Template Method Pattern)
- **ç›®çš„**ï¼šæ ‡å‡†åŒ–HTTPè¯·æ±‚å¤„ç†æµç¨‹
- **å®ç°**ï¼šå®šä¹‰ç»Ÿä¸€çš„ç­¾åâ†’è¯·æ±‚â†’å“åº”å¤„ç†æ¨¡æ¿

## ğŸ“ˆ æ¶æ„æ¼”è¿›è§„åˆ’

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ (å·²å®Œæˆ)
- âœ… HTTPç›´è¿æ¶æ„
- âœ… é˜¿é‡Œäº‘/è…¾è®¯äº‘æ”¯æŒ
- âœ… ç­¾åç®—æ³•è‡ªç ”
- âœ… æ•…éšœè½¬ç§»æœºåˆ¶

### Phase 2: æ‰©å±•åŠŸèƒ½ (è§„åˆ’ä¸­)
- ğŸ”„ æ›´å¤šäº‘æœåŠ¡å•†æ”¯æŒ
- ğŸ”„ æ‰¹é‡å‘é€ä¼˜åŒ–
- ğŸ”„ å¼‚æ­¥é˜Ÿåˆ—æ”¯æŒ
- ğŸ”„ ç›‘æ§å’ŒæŒ‡æ ‡æ”¶é›†

### Phase 3: ç”Ÿæ€å»ºè®¾ (è§„åˆ’ä¸­)
- ğŸ”„ WebAPIå°è£…
- ğŸ”„ gRPCæ”¯æŒ
- ğŸ”„ Kuberneteséƒ¨ç½²
- ğŸ”„ äº‘åŸç”Ÿé›†æˆ

## ğŸ† æ¶æ„ä¼˜åŠ¿æ€»ç»“

1. **æè‡´è½»é‡**ï¼š99.96%åŒ…ä½“ç§¯å‡å°‘ï¼Œé›¶å¤–éƒ¨ä¾èµ–
2. **é«˜æ€§èƒ½**ï¼š90%å¯åŠ¨æ—¶é—´å‡å°‘ï¼Œ80%å†…å­˜å ç”¨å‡å°‘
3. **é«˜å¯æ§**ï¼šå®Œå…¨æŒæ§ç­¾åç®—æ³•å’ŒHTTPè°ƒç”¨è¿‡ç¨‹
4. **æ˜“ç»´æŠ¤**ï¼šé€æ˜çš„è°ƒç”¨é“¾è·¯ï¼Œä¾¿äºè°ƒè¯•å’Œæ’é”™
5. **æ˜“æ‰©å±•**ï¼šæ ‡å‡†åŒ–çš„æ¥å£è®¾è®¡ï¼Œæ–°å¢æä¾›å•†æˆæœ¬ä½
6. **é«˜å¯é **ï¼šå®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ•…éšœè½¬ç§»æœºåˆ¶

PolySmsçš„HTTPç›´è¿æ¶æ„ä»£è¡¨äº†.NETç”Ÿæ€ä¸­SMS SDKçš„æ¼”è¿›æ–¹å‘ï¼š**è½»é‡ã€é«˜æ•ˆã€å¯æ§**ã€‚